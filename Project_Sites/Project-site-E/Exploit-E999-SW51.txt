! 
! Suited for WS-3650-24P 
! Document Version 1.0 
!
! Configuraton for Exploit-2999-SW50 
!
ip name-server 172.31.48.112 172.23.6.128
hostname Exploit-2999-SW50 
ip domain-name bunnings.com.au 
aaa new-model 
username install privilege 15 secret 0 ddddd
tacacs-server host 172.30.200.1 key cccccc
no tacacs-server directed-request 
aaa authentication login default group tacacs+ local 
aaa authentication enable default group tacacs+ none 
aaa accounting commands 0 default start-stop group tacacs+ 
aaa accounting commands 1 default start-stop group tacacs+ 
aaa accounting commands 15 default start-stop group tacacs+ 
no enable password 
enable secret level 15 0 cisco 
!
service password-encryption 
no service udp-small-servers  
no service tcp-small-servers 
no service finger 
no service config 
no errdisable detect cause all 
no ip finger 
crypto key generate rsa general-keys modulus 2048 
ip ssh time-out 60 
ip ssh authentication-retries 2 
ip ssh version 2 
no ip http server 
ip http authentication aaa 
no ip source-route 
no ip icmp redirect 
spanning-tree mode rapid-pvst 
spanning-tree uplinkfast 
ip rcmd rcp-enable 
ip rcmd remote-host cwuser 172.31.5.12 cwuser enable 15 
no ip rcmd domain-lookup 
clock timezone AWST 8 0 
service timestamps debug datetime show-timezone msec 
service timestamps log datetime show-timezone msec 
ip access-list standard CW_M_ACL 
 permit 172.31.5.12 
 permit 172.31.5.13
 deny any log 
 access-list 2 remark SNMP ACL 
 access-list 2 remark Permit Network Services, Statscout and Ciscoworks 
 access-list 2 permit 172.30.1.166 
 access-list 2 permit 172.31.5.0 0.0.0.255 
 access-list 2 deny any log 
! 
line con 0 
 exec-timeout 5 0 
 password cisco 
line vty 0 15 
 exec-timeout 5 0 
 password cisco 
 privilege level 15 
 logging sync 
! 
interface GigabitEthernet 1/0/1
no logging event link-status
 no snmp trap link-status
 spanning-tree portfast
 spanning-tree bpduguard enable
 switchport mode access
 switchport access vlan 1
 auto qos voip trust
 cdp enable
!
interface GigabitEthernet 1/0/2
no logging event link-status
 no snmp trap link-status
 spanning-tree portfast
 spanning-tree bpduguard enable
 switchport mode access
 switchport access vlan 2
 switchport voice vlan 6
 auto qos voip trust
 cdp enable
!
interface GigabitEthernet 1/0/3
no logging event link-status
 no snmp trap link-status
 spanning-tree portfast
 spanning-tree bpduguard enable
 switchport mode access
 switchport access vlan 2
 switchport voice vlan 6
 auto qos voip trust
 cdp enable
!
interface GigabitEthernet 1/0/4
no logging event link-status
 no snmp trap link-status
 spanning-tree portfast
 spanning-tree bpduguard enable
 switchport mode access
 switchport access vlan 2
 switchport voice vlan 6
 auto qos voip trust
 cdp enable
!
interface GigabitEthernet 1/0/5
no logging event link-status
 no snmp trap link-status
 spanning-tree portfast
 spanning-tree bpduguard enable
 switchport mode access
 switchport access vlan 2
 switchport voice vlan 6
 auto qos voip trust
 cdp enable
!
interface GigabitEthernet 1/0/6
description Security
 switchport mode access
 switchport access vlan 9
 logging event link-status
 no snmp trap link-status
 no spanning-tree portfast
 auto qos voip trust
 cdp enable
!
interface GigabitEthernet 1/0/7
no logging event link-status
 no snmp trap link-status
 spanning-tree portfast
 spanning-tree bpduguard enable
 switchport mode access
 switchport access vlan 2
 switchport voice vlan 6
 auto qos voip trust
 cdp enable
!
interface GigabitEthernet 1/0/8
no logging event link-status
 no snmp trap link-status
 spanning-tree portfast
 spanning-tree bpduguard enable
 switchport mode access
 switchport access vlan 2
 switchport voice vlan 6
 auto qos voip trust
 cdp enable
!
interface GigabitEthernet 1/0/9
no logging event link-status
 no snmp trap link-status
 spanning-tree portfast
 spanning-tree bpduguard enable
 switchport mode access
 switchport access vlan 3
 switchport voice vlan 6
 auto qos voip trust
 cdp enable
!
interface GigabitEthernet 1/0/10
no logging event link-status
 no snmp trap link-status
 spanning-tree portfast
 spanning-tree bpduguard enable
 switchport mode access
 switchport access vlan 3
 switchport voice vlan 6
 auto qos voip trust
 cdp enable
!
interface GigabitEthernet 1/0/11
no logging event link-status
 no snmp trap link-status
 spanning-tree portfast
 spanning-tree bpduguard enable
 switchport mode access
 switchport access vlan 2
 switchport voice vlan 6
 auto qos voip trust
 cdp enable
!
interface GigabitEthernet 1/0/12
no logging event link-status
 no snmp trap link-status
 spanning-tree portfast
 spanning-tree bpduguard enable
 switchport mode access
 switchport access vlan 1
 auto qos voip trust
 cdp enable
!
interface GigabitEthernet 1/0/13
no logging event link-status
 no snmp trap link-status
 spanning-tree portfast
 spanning-tree bpduguard enable
 switchport mode access
 switchport access vlan 3
 switchport voice vlan 6
 auto qos voip trust
 cdp enable
!
interface GigabitEthernet 1/0/14
description Security
 switchport mode access
 switchport access vlan 9
 logging event link-status
 no snmp trap link-status
 no spanning-tree portfast
 auto qos voip trust
 cdp enable
!
interface GigabitEthernet 1/0/15
no logging event link-status
 no snmp trap link-status
 spanning-tree portfast
 spanning-tree bpduguard enable
 switchport mode access
 switchport access vlan 2
 switchport voice vlan 6
 auto qos voip trust
 cdp enable
!
interface GigabitEthernet 1/0/16
no logging event link-status
 no snmp trap link-status
 spanning-tree portfast
 spanning-tree bpduguard enable
 switchport mode access
 switchport access vlan 3
 switchport voice vlan 6
 auto qos voip trust
 cdp enable
!
interface GigabitEthernet 1/0/17
description Store-Server-Teamed-NIC
 switchport mode trunk
 switchport nonegotiate
 spanning-tree portfast trunk
 spanning-tree guard root
 logging event link-status
 snmp trap link-status
 cdp enable
!
interface GigabitEthernet 1/0/18
description DECT Infrastructure Port
 switchport mode access
 switchport access vlan 6
 logging event link-status
 no snmp trap link-status
 no spanning-tree portfast
 auto qos voip trust
 cdp enable
!
interface GigabitEthernet 1/0/19
description DECT Infrastructure Port
 switchport mode access
 switchport access vlan 6
 logging event link-status
 no snmp trap link-status
 no spanning-tree portfast
 auto qos voip trust
 cdp enable
!
interface GigabitEthernet 1/0/20
description DECT Infrastructure Port
 switchport mode access
 switchport access vlan 6
 logging event link-status
 no snmp trap link-status
 no spanning-tree portfast
 auto qos voip trust
 cdp enable
!
interface GigabitEthernet 1/0/21
description Wireless Access Point
 switchport mode trunk
 switchport nonegotiate
 spanning-tree portfast trunk
 spanning-tree guard root
 logging event link-status
 snmp trap link-status
 cdp enable
!
interface GigabitEthernet 1/0/22
description Wireless Access Point
 switchport mode trunk
 switchport nonegotiate
 spanning-tree portfast trunk
 spanning-tree guard root
 logging event link-status
 snmp trap link-status
 cdp enable
!
interface GigabitEthernet 1/0/23
description Wireless Access Point
 switchport mode trunk
 switchport nonegotiate
 spanning-tree portfast trunk
 spanning-tree guard root
 logging event link-status
 snmp trap link-status
 cdp enable
!
interface GigabitEthernet 1/0/24
description None-Set
! 
interface range GigabitEthernet1/1/1 - 2 
no shutdown 
! 
 exit
! 
logging facility syslog 
logging 172.31.5.13
logging 172.31.5.12
logging discriminator nolog msg-body drops flapping 
logging buffered discriminator nolog 
logging buffered 16384 debugging 
logging console discriminator nolog 
logging monitor discriminator nolog 
snmp-server community geccyo258 RO 2 
snmp-server host 172.31.5.13 yyyyy 
snmp-server host 172.31.5.12 xxxxx 
snmp-server community xxxxx RW CW_M_ACL 
snmp-server location Store-WA
! 
banner motd "NO UNAUTHORISED ACCESS PERMITTED" 
! 
vtp version 2 
vtp mode client 
vtp domain Exploit-2999 
vtp password Bunnings 
! 
event manager applet VLAN1GateNTPConfiguration authorization bypass 
event tag e1 none 
event tag e2 timer countdown time 240 
trigger 
correlate event e1 or event e2 
action 10.0 info type routername 
action 10.1 set tempnum "NoneSet" 
action 10.2 set swnum "NoneSet" 
action 10.3 set ip "NoneSet" 
action 15.0 syslog msg "INFORMATIONAL: Started VLAN1GateNTPConfiguration" 
action 20.1 regexp "-SW[5-6][0-9]" $_info_routername tempnum 
action 20.2 regexp "[5-6][0-9]" $tempnum swnum 
action 29.0 cli command "enable" 
!action 29.1 cli command "debug event manager action cli" 
action 30.1 cli command "sh ip int br | i 172" 
action 30.2 regexp "172\.[0-9]+\.[0-9]+" $_cli_result ip 
!  
action 40.2 cli command "configure terminal" 
action 40.3 cli command "ip default-gateway $ip.126" 
action 40.4 cli command "ntp server $ip.126 prefer" 
! 
action 50.0 cli command "interface Vlan1" 
action 50.1 cli command "no ip unreachables" 
action 50.2 cli command "no ip directed-broadcast" 
action 50.3 cli command "no ip proxy-arp" 
action 50.4 cli command "no shut" 
action 50.5 cli command "no ip route-cache" 
action 50.6 cli command "ip address $ip.$swnum 255.255.255.128" 
action 98.0 set emtext "INFORMATIONAL: Finished VLAN1GateNTPConfiguration\r\r\rParameter Check: \r IP Address First 3 Octects: $ip \r Switch Number: $swnum" 
action 99.0 syslog msg "INFORMATIONAL: Finished VLAN1GateNTPConfiguration"  
action 99.1 mail server "smtp-gateway.bunnings.com.au" to "dclark@bunnings.com.au" from "$_info_routername@bunnings.com.au" subject "INFORMATIONAL: VLAN1GateNTPConfiguration Completed" body "$emtext" 
action 99.6 cli command "no event manager applet VLAN1GateNTPConfiguration authorization bypass" 
action 99.7 cli command "end" 
!action 99.8 cli command "no debug event manager action cli" 
exit 
! 
event manager applet PortAndTrunkConfiguration authorization bypass 
event tag e1 none 
event tag e2 timer countdown time 250 
trigger 
correlate event e1 or event e2 
action 10.0 info type routername 
action 10.1 set swnum "NoneSet" 
action 10.2 regexp "SW5[0-1]" $_info_routername swnum 
action 15.0 syslog msg "INFORMATIONAL: Started PortAndTrunkConfiguration" 
!  
action 20.0 cli command "enable" 
!action 20.1 cli command "debug event manager action cli" 
action 20.2 cli command "conf t" 
!  
action 30.0 if $swnum eq "SW50" 
action 30.1 cli command "interface range Te1/1/3 - 4" 
action 30.2 cli command "Description Inter-Switch Trunk" 
action 30.3 cli command "switchport mode trunk" 
action 30.4 cli command "auto qos voip trust" 
action 31.0 cli command "interface GigabitEthernet1/0/24" 
action 31.1 cli command "Description SW-RTR Uplink" 
action 31.2 cli command "switchport mode trunk" 
action 31.3 cli command "auto qos voip trust" 
action 39.1 cli command "spanning-tree vlan 1-50 root primary" 
!  
action 40.0 elseif $swnum eq "SW51" 
action 40.1 cli command "interface range Te1/1/3 - 4" 
action 40.2 cli command "Description Inter-Switch Trunk" 
action 40.3 cli command "switchport mode trunk" 
action 40.4 cli command "auto qos voip trust" 
action 41.0 cli command "interface GigabitEthernet1/0/24" 
action 41.1 cli command "Description SW-RTR Uplink" 
action 41.2 cli command "switchport mode trunk" 
action 41.3 cli command "auto qos voip trust" 
action 49.0 cli command "exit" 
action 49.1 cli command "spanning-tree vlan 1-50 root secondary" 
!  
action 50.0 else 
action 50.1 cli command "interface range Te1/1/3 - 4" 
action 50.2 cli command "Description Inter-Switch Trunk" 
action 50.3 cli command "switchport mode trunk" 
action 50.4 cli command "auto qos voip trust" 
action 52.0 cli command "exit" 
action 52.1 end 
!  
action 98.0 set emtext "INFORMATIONAL: Finished PortAndTrunkConfiguration\r\r\rParameter Check: \r Switch Number: $swnum" 
action 99.0 syslog msg "INFORMATIONAL: Finished PortAndTrunkConfiguration" 
action 99.1 mail server "smtp-gateway.bunnings.com.au" to "dclark@bunnings.com.au" from "$_info_routername@bunnings.com.au" subject "INFORMATIONAL: PortAndTrunkConfiguration Completed" body "$emtext" 
action 99.6 cli command "no event manager applet PortAndTrunkConfiguration authorization bypass" 
action 99.7 cli command "end" 
!action 99.8 cli command "no debug event manager action cli" 
exit 
! 
event manager applet AAAConfiguration authorization bypass 
event tag e1 none 
event tag e2 timer countdown time 260 
trigger 
correlate event e1 or event e2 
action 10.0 info type routername 
action 10.1 syslog msg "INFORMATIONAL: Started AAAConfiguration" 
action 11.0 cli command "enable" 
!action 10.1 cli command "debug event manager action cli" 
action 11.2 cli command "conf t" 
action 15.1 cli command "aaa authorization config-commands" 
action 15.2 cli command "aaa authorization commands 0 default local group tacacs+" 
action 15.3 cli command "aaa authorization commands 1 default local group tacacs+" 
action 15.4 cli command "aaa authorization commands 15 default local group tacacs+" 
action 98.0 set emtext "INFORMATIONAL: Finished AAAConfiguration\r\r\rParameter Check: \r None Used" 
action 99.0 syslog msg "INFORMATIONAL: Finished AAAConfiguration" 
action 99.1 mail server "smtp-gateway.bunnings.com.au" to "dclark@bunnings.com.au" from "$_info_routername@bunnings.com.au" subject "INFORMATIONAL: AAAConfiguration Completed" body "$emtext" 
action 99.6 cli command "no event manager applet AAAConfiguration authorization bypass" 
action 99.7 cli command "end" 
!action 99.8 cli command "no debug event manager action cli" 
exit 
! 
event manager applet SaveConfigCleaner authorization bypass 
event tag e1 none 
event tag e2 timer countdown time 270 
trigger 
correlate event e1 or event e2 
action 10.0 info type routername 
action 10.1 cli command "enable" 
!action 10.2 cli command "debug event manager action cli" 
action 15.0 syslog msg "INFORMATIONAL: Started SaveConfigCleaner" 
action 20.0 cli command "copy running-config startup-config" pattern "Destination" 
action 20.1 cli command "" 
!action 30.0 cli command "no debug event manager action cli" 
action 90.0 syslog msg "INFORMATIONAL: Finished SaveConfigCleaner" 
action 98.0 set emtext "Final Scripted Config \r Please validate the switch" 
action 98.9 mail server "smtp-gateway.bunnings.com.au" to "dclark@bunnings.com.au" from "$_info_routername@bunnings.com.au" subject "INFORMATIONAL: Finished SaveConfigCleaner" body "$emtext" 
action 99.0 cli command "conf t" 
action 99.9 cli command "no event manager applet SaveConfigCleaner authorization bypass" 
exit 
! 
end 
copy run start 
 
